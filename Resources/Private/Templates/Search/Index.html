{namespace lc=Slub\LisztCommon\ViewHelpers}
<html
    xmlns:f="http://typo3.org/ns/TYPO3/CMS/Fluid/ViewHelpers"
    xmlns:i="http://typo3.org/ns/Quellenform/Iconpack/ViewHelpers"
    data-namespace-typo3-fluid="true">


<div class="searchresults-info frame">
    <div class="searchresults-info-total">
    <output class="searchresults-total-items">{totalItems} {f:translate(key: 'searchResults_hits_label', extensionName: 'liszt_common')}</output>
    <button class="filter-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#filter-container" aria-controls="filter-container">
        {f:translate(key: 'filter_container_label', extensionName: 'liszt_common')}
    </button>
    </div>
    <f:debug>{_all}</f:debug>

    <f:if condition="{searchParams}">
    <div class="searchresults-filtertags" aria-label="{f:translate(key: 'searchResults_params_label', extensionName: 'liszt_common')}" role="navigation" >
        <f:for each="{searchParams}" key="key" as="searchParam">
            <span class="searchresults-filtertags-tag">
                <span>{searchParam}</span>
                 <f:link.action action="index" controller="Search" pluginName="SearchListing" arguments="{lc:searchParams(action: 'remove', searchParamsArray: searchParams, key: key)}"  additionalAttributes="{type:'button'}" class="tag-cross">
                    <span class="visually-hidden">{f:translate(key: 'searchResults_params_remove_label',  arguments: {0: searchParam}, extensionName: 'liszt_common')}</span>
                    <svg aria-hidden="true" stroke="currentColor" fill="none" viewBox="0 0 8 8"><path stroke-linecap="round" stroke-width="1" d="M1 1l6 6m0-6L1 7"></path></svg>
                 </f:link.action>
            </span>
        </f:for>
    </div>
    </f:if>

</div>


<aside class="sidebar">
    <nav class="filter-container offcanvas offcanvas-end" id="filter-container" aria-label="{f:translate(key: 'filter_container_label', extensionName: 'liszt_common')}" >
        <div class="offcanvas-header">
            <h5 class="offcanvas-title">{f:translate(key: 'filter_container_label', extensionName: 'liszt_common')}</h5>
            <button type="button" class="btn-close " data-bs-dismiss="offcanvas" aria-label="{f:translate(key: 'filter_container_close', extensionName: 'liszt_common')}">
                <i:icon iconfig="lzicon,close" preferredRenderTypes="svgSprite" additionalAttributes="{aria-hidden:'true'}" />
            </button>
        </div>
        <div class="offcanvas-body">
        <f:for each="{searchResults.aggregations}" key="key" as="filterGroup">
            <f:if condition="{filterGroup.buckets}">
                <div class="filter-block frame">
                    <h4 class="">{key}</h4>
                    <f:variable name="searchParamsFilterKey">f_{key}</f:variable>
                    <ul>
                        <f:for each="{filterGroup.buckets}" as="filter">
                            <li>
                                <f:if condition="{searchParams.{searchParamsFilterKey}} == {filter.key}">
                                <f:then>
                                    <f:link.action action="index" controller="Search" pluginName="SearchListing" arguments="{lc:searchParams(action: 'remove', searchParamsArray: searchParams, key: searchParamsFilterKey)}" class="filter-item selected">
                                        <span class="filter-item-label">{filter.key}</span>
                                        <span class="filter-item-count">{filter.doc_count}</span>
                                    </f:link.action>
                                </f:then>
                                <f:else>
                                    <f:link.action action="index" controller="Search" pluginName="SearchListing" arguments="{lc:searchParams(action: 'add', searchParamsArray: searchParams, key: searchParamsFilterKey, value: filter.key)}" class="filter-item">
                                        <span class="filter-item-label">{filter.key}</span>
                                        <span class="filter-item-count">{filter.doc_count}</span>
                                    </f:link.action>
                                </f:else>
                                </f:if>
                            </li>



                            <f:comment> <!--  old versions of filter (form input), ToDo: remove later if not needed-->
                             <li><f:link.action action="index" controller="Search" pluginName="SearchListing" arguments="{searchParams: {f_itemType: filter.key}}" class="form-checkbox"><input class="form-check-input" type="checkbox" id="{filter.key}" value="{filter.key}"><label class="form-check-label" for="{filter.key}">{filter.key}</label><span class="count">{filter.doc_count}</span></f:link.action></li>
                             <li><a href="{f:uri.action(controller: 'Search', action: 'index', extensionName: 'liszt_common', pluginName: 'SearchListing', pageUid: '18')}" class="form-checkbox"><input class="form-check-input" type="checkbox" id="{filter.key}" value="{filter.key}"><label class="form-check-label" for="{filter.key}">{filter.key}</label></a><span class="count">{filter.doc_count}</span></li>
                            <li><span class="form-checkbox"><input class="form-check-input" type="checkbox" id="{filter.key}" value="{filter.key}"><label class="form-check-label" for="{filter.key}">{filter.key}</label></span><span class="count">{filter.doc_count}</span></li>
                            </f:comment>

                        </f:for>
                    </ul>
                </div>
            </f:if>
        </f:for>
        </div>
    </nav>

</aside>
<div class="content grid-colspan-lg-3 grid-colspan-md-2">
    <div class="frame">


    <f:for each="{searchResults.hits.hits}" as="hit">
        <article class="searchresults-item ">
            <header>
                <div class="searchresults-item-label">
                    {hit._source.tx_lisztcommon_header}
                </div>
                <div class="searchresults-item-title">
                <div class="searchresults-item-icon"><i:icon iconfig="{lc:ItemTypeIconName(iconPackKey: 'lziconsr', itemType: hit._source.itemType)}" preferredRenderTypes="svgSprite" additionalAttributes="{aria-hidden:'true'}" /></div>
                <h3 >
                    {hit._source.tx_lisztcommon_body}
                </h3>
                </div>
            </header>
            <div class="searchresults-item-details">
                {hit._source.tx_lisztcommon_footer}
            </div>
        </article>
    </f:for>
    </div>
</div>
